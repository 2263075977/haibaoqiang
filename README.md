# è±†ç“£å½±è§†æ•°æ®çˆ¬å–åˆ°Notionå·¥å…·

è¿™æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–å·¥å…·ï¼Œç”¨äºä»è±†ç“£ç½‘ç«™æœç´¢å’Œæå–ç”µå½±/ç”µè§†å‰§ä¿¡æ¯ï¼Œç„¶åå°†è¯¦ç»†æ•°æ®æ·»åŠ åˆ°Notionæ•°æ®åº“ã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- ğŸ” **æœç´¢è±†ç“£ç”µå½±/ç”µè§†å‰§**ï¼šæ ¹æ®å…³é”®è¯æœç´¢å½±è§†ä½œå“
- ğŸ“ **æå–è¯¦ç»†ä¿¡æ¯**ï¼šè‡ªåŠ¨è·å–å¯¼æ¼”ã€ç¼–å‰§ã€æ¼”å‘˜ã€ç±»å‹ã€è¯„åˆ†ç­‰è¯¦ç»†ä¿¡æ¯
- ğŸ–¼ï¸ **æ ¼å¼åŒ–å‰§æƒ…ç®€ä»‹**ï¼šè‡ªåŠ¨ä¸ºç®€ä»‹æ·»åŠ æ®µè½å’Œä¸­æ–‡ç¼©è¿›æ ¼å¼
- ğŸ”— **äººå‘˜é“¾æ¥æ”¯æŒ**ï¼šå¯¼æ¼”ã€ç¼–å‰§ã€æ¼”å‘˜ä¿¡æ¯åŒ…å«åŸå§‹è±†ç“£é“¾æ¥
- ğŸ“Š **è‡ªåŠ¨åˆ†ç±»**ï¼šè‡ªåŠ¨è¯†åˆ«ç”µå½±å’Œç”µè§†å‰§
- ğŸ“² **Notioné›†æˆ**ï¼šå°†æ‰€æœ‰æ•°æ®è‡ªåŠ¨æ·»åŠ åˆ°Notionæ•°æ®åº“

## å®‰è£…è¯´æ˜

### å‰ææ¡ä»¶

- Python 3.7+
- Chromeæµè§ˆå™¨
- Notionè´¦æˆ·å’ŒAPIå¯†é’¥

### å®‰è£…æ­¥éª¤

1. å…‹éš†æˆ–ä¸‹è½½æœ¬é¡¹ç›®
2. å®‰è£…ä¾èµ–ï¼š
   ```bash
   pip install -r requirements.txt
   ```

3. åˆ›å»º`.env`æ–‡ä»¶ï¼Œè®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š
   ```
   # Notionç›¸å…³
   NOTION_TOKEN=your_notion_integration_token
   NOTION_DATABASE_ID=your_notion_database_id
   
   # è±†ç“£Cookieç›¸å…³(å¯é€‰)
   DOUBAN_BID=your_douban_bid
   DOUBAN_LL=your_douban_ll
   DOUBAN_DBCL2=your_douban_dbcl2
   DOUBAN_CK=your_douban_ck
   ```

## Notionæ•°æ®åº“è®¾ç½®

åœ¨Notionä¸­åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œå¹¶ç¡®ä¿åŒ…å«ä»¥ä¸‹å±æ€§ï¼š

- **åç§°** (æ ‡é¢˜ç±»å‹)ï¼šå½±ç‰‡æ ‡é¢˜
- **ç±»åˆ«** (é€‰æ‹©ç±»å‹)ï¼šç”µå½±/ç”µè§†å‰§
- **å¯¼æ¼”** (å¯Œæ–‡æœ¬ç±»å‹)ï¼šå¯¼æ¼”ä¿¡æ¯
- **ç¼–å‰§** (å¯Œæ–‡æœ¬ç±»å‹)ï¼šç¼–å‰§ä¿¡æ¯
- **ä¸»æ¼”** (å¯Œæ–‡æœ¬ç±»å‹)ï¼šæ¼”å‘˜ä¿¡æ¯
- **ç±»å‹** (å¤šé€‰ç±»å‹)ï¼šå½±ç‰‡ç±»å‹æ ‡ç­¾
- **è¯­è¨€** (å¤šé€‰ç±»å‹)ï¼šå½±ç‰‡è¯­è¨€
- **è¯„åˆ†** (æ•°å­—ç±»å‹)ï¼šè±†ç“£è¯„åˆ†
- **IMDb** (å¯Œæ–‡æœ¬ç±»å‹)ï¼šIMDbç¼–å·
- **é¦–æ’­** (å¯Œæ–‡æœ¬ç±»å‹)ï¼šä¸Šæ˜ æ—¥æœŸ
- **ç®€ä»‹** (å¯Œæ–‡æœ¬ç±»å‹)ï¼šå½±ç‰‡å‰§æƒ…ç®€ä»‹
- **åˆå** (å¯Œæ–‡æœ¬ç±»å‹)ï¼šå½±ç‰‡åˆ«å

ç„¶åï¼Œå°†æ•°æ®åº“ä¸ä½ åˆ›å»ºçš„Notioné›†æˆå…±äº«ã€‚

## ä½¿ç”¨æ–¹æ³•

### å‘½ä»¤è¡Œæ¨¡å¼

è¿è¡Œä¸»ç¨‹åºï¼š

```bash
python main.py
```

1. è¾“å…¥è¦æœç´¢çš„ç”µå½±æˆ–ç”µè§†å‰§åç§°
2. ç¨‹åºè‡ªåŠ¨é€‰æ‹©æœ€åŒ¹é…çš„å½±ç‰‡å¹¶æå–è¯¦æƒ…
3. è¯¦æƒ…ä¿¡æ¯è‡ªåŠ¨æ·»åŠ åˆ°Notionæ•°æ®åº“

æ“ä½œç®€å•ï¼Œä¸€é”®å®Œæˆä»æœç´¢åˆ°æ·»åŠ çš„å…¨è¿‡ç¨‹ã€‚

### APIæœåŠ¡æ¨¡å¼

å¯åŠ¨APIæœåŠ¡å™¨ï¼š

```bash
python api.py
```

æœåŠ¡å¯åŠ¨åï¼Œå°†åœ¨ http://localhost:8000 æä¾›ä»¥ä¸‹APIç«¯ç‚¹ï¼š

- **POST /search** - æœç´¢ç”µå½±
  ```json
  {"keyword": "ç”µå½±åç§°"}
  ```

- **POST /movie/details** - è·å–ç”µå½±è¯¦æƒ…
  ```json
  {"url": "è±†ç“£ç”µå½±URL"}
  ```

- **POST /add_to_notion** - æ·»åŠ ç”µå½±åˆ°Notion
  ```json
  {"movie_data": {...ç”µå½±è¯¦ç»†ä¿¡æ¯...}}
  ```

- **POST /search_and_add** - ä¸€ç«™å¼æœç´¢å¹¶æ·»åŠ 
  ```json
  {"keyword": "ç”µå½±åç§°"}
  ```

APIæœåŠ¡å™¨è‡ªå¸¦äº¤äº’å¼æ–‡æ¡£ï¼Œè®¿é—® http://localhost:8000/docs æŸ¥çœ‹è¯¦ç»†APIè¯´æ˜ã€‚

### APIå®¢æˆ·ç«¯ç¤ºä¾‹

æä¾›äº†ç¤ºä¾‹å®¢æˆ·ç«¯è„šæœ¬ï¼Œå±•ç¤ºå¦‚ä½•è°ƒç”¨APIï¼š

```bash
# ä¸€ç«™å¼æ¨¡å¼
python api_client_example.py ç”µå½±åç§°

# åˆ†æ­¥éª¤æ¨¡å¼
python api_client_example.py --steps ç”µå½±åç§°
```

## æ³¨æ„äº‹é¡¹

- æœ¬å·¥å…·ä»…ä¾›ä¸ªäººå­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨
- è¯·éµå®ˆè±†ç“£ç½‘ç«™çš„ä½¿ç”¨æ¡æ¬¾å’Œrobots.txtè§„å®š
- é¢‘ç¹æŠ“å–æ•°æ®å¯èƒ½å¯¼è‡´IPè¢«é™åˆ¶ï¼Œè¯·é€‚åº¦ä½¿ç”¨

## è®¸å¯è¯

MIT 

## Dockeréƒ¨ç½²

æœ¬é¡¹ç›®æ”¯æŒé€šè¿‡Dockeréƒ¨ç½²ï¼Œå¹¶å¯ä»¥é…åˆGitHub Actionsè‡ªåŠ¨æ„å»ºé•œåƒã€‚

### ä½¿ç”¨é¢„æ„å»ºé•œåƒ

åœ¨ç¾¤æ™–Dockerä¸Šéƒ¨ç½²ï¼š

1. åœ¨ç¾¤æ™–Dockerä¸­æ·»åŠ æ˜ åƒï¼Œä½¿ç”¨GitHub Container Registryåœ°å€ï¼š
   ```
   ghcr.io/[æ‚¨çš„GitHubç”¨æˆ·å]/douban-notion:main
   ```

2. åˆ›å»ºå®¹å™¨æ—¶è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
   - `NOTION_TOKEN`: Notion APIå¯†é’¥
   - `NOTION_DATABASE_ID`: Notionæ•°æ®åº“ID
   - å¯é€‰çš„è±†ç“£Cookie: `DOUBAN_BID`, `DOUBAN_LL`, `DOUBAN_DBCL2`, `DOUBAN_CK`

3. è®¾ç½®ç«¯å£æ˜ å°„ï¼š
   - å®¹å™¨ç«¯å£: 8000
   - æœ¬åœ°ç«¯å£: æ‚¨å¸Œæœ›ä½¿ç”¨çš„ç«¯å£(å¦‚8000)

### ä½¿ç”¨docker-compose

1. å¤åˆ¶é¡¹ç›®ä¸­çš„`docker-compose.yml`å’Œ`.env.example`æ–‡ä»¶åˆ°æ‚¨çš„ç¾¤æ™–
2. å°†`.env.example`é‡å‘½åä¸º`.env`å¹¶å¡«å…¥æ‚¨çš„é…ç½®ä¿¡æ¯
3. æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡ï¼š
   ```bash
   docker-compose up -d
   ```

## è‡ªå»ºé•œåƒéƒ¨ç½²æµç¨‹

### 1. å°†é¡¹ç›®æ¨é€åˆ°GitHub

1. åœ¨GitHubåˆ›å»ºæ–°ä»“åº“
2. åˆå§‹åŒ–æœ¬åœ°ä»“åº“å¹¶æ¨é€ï¼š
   ```bash
   git init
   git add .
   git commit -m "Initial commit"
   git branch -M main
   git remote add origin https://github.com/æ‚¨çš„ç”¨æˆ·å/douban-notion.git
   git push -u origin main
   ```

### 2. å¯ç”¨GitHub Actions

1. åœ¨GitHubä»“åº“è®¾ç½®ä¸­ï¼Œç¡®ä¿å¯ç”¨äº†GitHub Actions
2. åœ¨ä»“åº“è®¾ç½® -> Secretsä¸­æ·»åŠ å¿…è¦çš„å¯†é’¥ï¼ˆå¦‚æœéœ€è¦ï¼‰
3. æ¨é€ä»£ç æ—¶ä¼šè‡ªåŠ¨è§¦å‘æ„å»ºæµç¨‹ï¼Œæ„å»ºå®ŒæˆåDockeré•œåƒä¼šè¢«æ¨é€åˆ°GitHub Container Registry

### 3. åœ¨ç¾¤æ™–ä¸Šéƒ¨ç½²

1. åœ¨ç¾¤æ™–Dockerä¸­ç™»å½•GitHub Container Registryï¼ˆå¦‚éœ€è¦ï¼‰
2. æ‹‰å–è‡ªåŠ¨æ„å»ºçš„é•œåƒ
3. ä½¿ç”¨ä¸Šè¿°"ä½¿ç”¨é¢„æ„å»ºé•œåƒ"æˆ–"ä½¿ç”¨docker-compose"çš„æ–¹æ³•éƒ¨ç½²

## APIè°ƒç”¨ç¤ºä¾‹

ä½¿ç”¨Dockeréƒ¨ç½²åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è°ƒç”¨APIï¼š

```bash
# æœç´¢ç”µå½±
curl -X POST http://æ‚¨çš„ç¾¤æ™–IP:8000/search -H "Content-Type: application/json" -d '{"keyword":"ç”µå½±åç§°"}'

# ä¸€ç«™å¼æœåŠ¡ï¼ˆæœç´¢å¹¶æ·»åŠ ï¼‰
curl -X POST http://æ‚¨çš„ç¾¤æ™–IP:8000/search_and_add -H "Content-Type: application/json" -d '{"keyword":"ç”µå½±åç§°"}'
```

æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®APIæ–‡æ¡£ï¼š http://æ‚¨çš„ç¾¤æ™–IP:8000/docs 