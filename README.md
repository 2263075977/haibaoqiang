# è±†ç“£å½±è§†æ•°æ®çˆ¬å–åˆ°Notionå·¥å…·

è¿™æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–å·¥å…·ï¼Œç”¨äºä»è±†ç“£ç½‘ç«™æœç´¢å’Œæå–ç”µå½±/ç”µè§†å‰§ä¿¡æ¯ï¼Œç„¶åå°†è¯¦ç»†æ•°æ®æ·»åŠ åˆ°Notionæ•°æ®åº“ã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- ğŸ” **æœç´¢è±†ç“£ç”µå½±/ç”µè§†å‰§**ï¼šæ ¹æ®å…³é”®è¯æœç´¢å½±è§†ä½œå“
- ğŸ“ **æå–è¯¦ç»†ä¿¡æ¯**ï¼šè‡ªåŠ¨è·å–å¯¼æ¼”ã€ç¼–å‰§ã€æ¼”å‘˜ã€ç±»å‹ã€è¯„åˆ†ç­‰è¯¦ç»†ä¿¡æ¯
- ğŸ–¼ï¸ **æ ¼å¼åŒ–å‰§æƒ…ç®€ä»‹**ï¼šè‡ªåŠ¨ä¸ºç®€ä»‹æ·»åŠ æ®µè½å’Œä¸­æ–‡ç¼©è¿›æ ¼å¼
- ğŸ”— **äººå‘˜é“¾æ¥æ”¯æŒ**ï¼šå¯¼æ¼”ã€ç¼–å‰§ã€æ¼”å‘˜ä¿¡æ¯åŒ…å«åŸå§‹è±†ç“£é“¾æ¥
- ğŸ“Š **è‡ªåŠ¨åˆ†ç±»**ï¼šè‡ªåŠ¨è¯†åˆ«ç”µå½±å’Œç”µè§†å‰§
- ğŸ“² **Notioné›†æˆ**ï¼šå°†æ‰€æœ‰æ•°æ®è‡ªåŠ¨æ·»åŠ åˆ°Notionæ•°æ®åº“

## å®‰è£…è¯´æ˜

### å‰ææ¡ä»¶

- Python 3.7+
- Chromeæµè§ˆå™¨
- Notionè´¦æˆ·å’ŒAPIå¯†é’¥

### å®‰è£…æ­¥éª¤

1. å…‹éš†æˆ–ä¸‹è½½æœ¬é¡¹ç›®
2. å®‰è£…ä¾èµ–ï¼š
   ```bash
   pip install -r requirements.txt
   ```

3. åˆ›å»º`.env`æ–‡ä»¶ï¼Œè®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š
   ```
   # Notionç›¸å…³
   NOTION_TOKEN=your_notion_integration_token
   NOTION_DATABASE_ID=your_notion_database_id
   
   # è±†ç“£Cookieç›¸å…³(å¯é€‰)
   DOUBAN_BID=your_douban_bid
   DOUBAN_LL=your_douban_ll
   DOUBAN_DBCL2=your_douban_dbcl2
   DOUBAN_CK=your_douban_ck
   ```

## Notionæ•°æ®åº“è®¾ç½®

åœ¨Notionä¸­åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œå¹¶ç¡®ä¿åŒ…å«ä»¥ä¸‹å±æ€§ï¼š

- **åç§°** (æ ‡é¢˜ç±»å‹)ï¼šå½±ç‰‡æ ‡é¢˜
- **ç±»åˆ«** (é€‰æ‹©ç±»å‹)ï¼šç”µå½±/ç”µè§†å‰§
- **å¯¼æ¼”** (å¯Œæ–‡æœ¬ç±»å‹)ï¼šå¯¼æ¼”ä¿¡æ¯
- **ç¼–å‰§** (å¯Œæ–‡æœ¬ç±»å‹)ï¼šç¼–å‰§ä¿¡æ¯
- **ä¸»æ¼”** (å¯Œæ–‡æœ¬ç±»å‹)ï¼šæ¼”å‘˜ä¿¡æ¯
- **ç±»å‹** (å¤šé€‰ç±»å‹)ï¼šå½±ç‰‡ç±»å‹æ ‡ç­¾
- **è¯­è¨€** (å¤šé€‰ç±»å‹)ï¼šå½±ç‰‡è¯­è¨€
- **è¯„åˆ†** (æ•°å­—ç±»å‹)ï¼šè±†ç“£è¯„åˆ†
- **IMDb** (å¯Œæ–‡æœ¬ç±»å‹)ï¼šIMDbç¼–å·
- **é¦–æ’­** (å¯Œæ–‡æœ¬ç±»å‹)ï¼šä¸Šæ˜ æ—¥æœŸ
- **ç®€ä»‹** (å¯Œæ–‡æœ¬ç±»å‹)ï¼šå½±ç‰‡å‰§æƒ…ç®€ä»‹
- **åˆå** (å¯Œæ–‡æœ¬ç±»å‹)ï¼šå½±ç‰‡åˆ«å

ç„¶åï¼Œå°†æ•°æ®åº“ä¸ä½ åˆ›å»ºçš„Notioné›†æˆå…±äº«ã€‚

## ä½¿ç”¨æ–¹æ³•

### å‘½ä»¤è¡Œæ¨¡å¼

è¿è¡Œä¸»ç¨‹åºï¼š

```bash
python main.py
```

1. è¾“å…¥è¦æœç´¢çš„ç”µå½±æˆ–ç”µè§†å‰§åç§°
2. ç¨‹åºè‡ªåŠ¨é€‰æ‹©æœ€åŒ¹é…çš„å½±ç‰‡å¹¶æå–è¯¦æƒ…
3. è¯¦æƒ…ä¿¡æ¯è‡ªåŠ¨æ·»åŠ åˆ°Notionæ•°æ®åº“

æ“ä½œç®€å•ï¼Œä¸€é”®å®Œæˆä»æœç´¢åˆ°æ·»åŠ çš„å…¨è¿‡ç¨‹ã€‚

### APIæœåŠ¡æ¨¡å¼

å¯åŠ¨APIæœåŠ¡å™¨ï¼š

```bash
python api.py
```

æœåŠ¡å¯åŠ¨åï¼Œå°†åœ¨ http://localhost:8000 æä¾›ä»¥ä¸‹APIç«¯ç‚¹ï¼š

- **POST /search** - æœç´¢ç”µå½±
  ```json
  {"keyword": "ç”µå½±åç§°"}
  ```

- **POST /movie/details** - è·å–ç”µå½±è¯¦æƒ…
  ```json
  {"url": "è±†ç“£ç”µå½±URL"}
  ```

- **POST /add_to_notion** - æ·»åŠ ç”µå½±åˆ°Notion
  ```json
  {"movie_data": {...ç”µå½±è¯¦ç»†ä¿¡æ¯...}}
  ```

- **POST /search_and_add** - ä¸€ç«™å¼æœç´¢å¹¶æ·»åŠ 
  ```json
  {"keyword": "ç”µå½±åç§°"}
  ```

APIæœåŠ¡å™¨è‡ªå¸¦äº¤äº’å¼æ–‡æ¡£ï¼Œè®¿é—® http://localhost:8000/docs æŸ¥çœ‹è¯¦ç»†APIè¯´æ˜ã€‚

### APIå®¢æˆ·ç«¯ç¤ºä¾‹

æä¾›äº†ç¤ºä¾‹å®¢æˆ·ç«¯è„šæœ¬ï¼Œå±•ç¤ºå¦‚ä½•è°ƒç”¨APIï¼š

```bash
# ä¸€ç«™å¼æ¨¡å¼
python api_client_example.py ç”µå½±åç§°

# åˆ†æ­¥éª¤æ¨¡å¼
python api_client_example.py --steps ç”µå½±åç§°
```

## æ³¨æ„äº‹é¡¹

- æœ¬å·¥å…·ä»…ä¾›ä¸ªäººå­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨
- è¯·éµå®ˆè±†ç“£ç½‘ç«™çš„ä½¿ç”¨æ¡æ¬¾å’Œrobots.txtè§„å®š
- é¢‘ç¹æŠ“å–æ•°æ®å¯èƒ½å¯¼è‡´IPè¢«é™åˆ¶ï¼Œè¯·é€‚åº¦ä½¿ç”¨

## è®¸å¯è¯

MIT 

## Dockeréƒ¨ç½²

### ä½¿ç”¨Seleniumå®˜æ–¹é•œåƒï¼ˆæ¨èï¼‰

æœ¬é¡¹ç›®ç°åœ¨ä½¿ç”¨Seleniumå®˜æ–¹é•œåƒï¼Œæä¾›æ›´ç¨³å®šçš„Chromeå’ŒChromeDriveræ”¯æŒï¼š

```bash
docker run -d --name douban-notion-api \
  -p 8000:8000 \
  -e NOTION_TOKEN=your_token_here \
  -e NOTION_DATABASE_ID=your_database_id_here \
  ghcr.io/your-username/douban-notion:selenium
```

### ä½¿ç”¨é¢„æ„å»ºé•œåƒï¼ˆåŸç‰ˆï¼‰

```bash
docker run -d --name douban-notion-api \
  -p 8000:8000 \
  -e NOTION_TOKEN=your_token_here \
  -e NOTION_DATABASE_ID=your_database_id_here \
  ghcr.io/your-username/douban-notion:latest
```

### ä½¿ç”¨Docker Compose

1. å…‹éš†ä»“åº“
```bash
git clone https://github.com/your-username/douban-notion.git
cd douban-notion
```

2. åˆ›å»º.envæ–‡ä»¶
```
NOTION_TOKEN=your_token_here
NOTION_DATABASE_ID=your_database_id_here
DOUBAN_BID=your_douban_bid
DOUBAN_LL=your_douban_ll
DOUBAN_DBCL2=your_douban_dbcl2
DOUBAN_CK=your_douban_ck
```

3. å¯åŠ¨æœåŠ¡
```bash
docker-compose up -d
```

## åœ¨ç¾¤æ™–ä¸Šéƒ¨ç½²

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨Dockerè½¯ä»¶åŒ…

1. åœ¨ç¾¤æ™–DSMä¸­æ‰“å¼€Dockeråº”ç”¨
2. åœ¨"æ³¨å†Œè¡¨"ä¸­æœç´¢`ghcr.io/your-username/douban-notion`
3. é€‰æ‹©å¹¶ä¸‹è½½å¸¦æœ‰`selenium`æ ‡ç­¾çš„é•œåƒç‰ˆæœ¬ï¼ˆæ¨èï¼‰
4. åœ¨"æ˜ åƒ"ä¸­æ‰¾åˆ°ä¸‹è½½çš„é•œåƒï¼Œç‚¹å‡»"å¯åŠ¨"
5. é…ç½®ç«¯å£æ˜ å°„ï¼š8000 -> 8000
6. æ·»åŠ ç¯å¢ƒå˜é‡ï¼š
   - NOTION_TOKEN
   - NOTION_DATABASE_ID
   - å¯é€‰ï¼šDOUBAN_BID, DOUBAN_LL, DOUBAN_DBCL2, DOUBAN_CK
7. ç‚¹å‡»"åº”ç”¨"å¹¶å¯åŠ¨å®¹å™¨

### æ–¹æ³•äºŒï¼šä½¿ç”¨Docker Compose

1. åœ¨ç¾¤æ™–ä¸Šå®‰è£…Gitå’ŒDocker Compose
   ```bash
   # é€šè¿‡SSHè¿æ¥åˆ°ç¾¤æ™–
   sudo -i
   apk add git docker-compose
   ```

2. å…‹éš†ä»“åº“å¹¶éƒ¨ç½²
   ```bash
   git clone https://github.com/your-username/douban-notion.git
   cd douban-notion
   
   # åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
   nano .env
   # æ·»åŠ å¿…è¦çš„ç¯å¢ƒå˜é‡...
   
   # å¯åŠ¨æœåŠ¡
   docker-compose up -d
   ```

## ç‰¹åˆ«è¯´æ˜ï¼šSeleniumå®˜æ–¹é•œåƒ

æœ¬é¡¹ç›®æä¾›äº†åŸºäºSeleniumå®˜æ–¹é•œåƒï¼ˆselenium/standalone-chromeï¼‰çš„ç‰ˆæœ¬ï¼Œè§£å†³äº†ChromeDriverå…¼å®¹æ€§é—®é¢˜ã€‚ä¸æ™®é€šé•œåƒç›¸æ¯”ï¼š

1. **ä¼˜åŠ¿**ï¼š
   - Chromeå’ŒChromeDriverç‰ˆæœ¬åŒ¹é…ï¼Œé¿å…å…¼å®¹æ€§é—®é¢˜
   - å†…ç½®VNCæœåŠ¡å™¨ï¼Œå¯ä»¥è¿œç¨‹æŸ¥çœ‹æµè§ˆå™¨è¿è¡ŒçŠ¶æ€
   - ç”±Seleniumå®˜æ–¹ç»´æŠ¤ï¼Œç¨³å®šæ€§æ›´é«˜

2. **ä½¿ç”¨VNCæŸ¥çœ‹æµè§ˆå™¨è¿è¡ŒçŠ¶æ€**ï¼š
   å¦‚æœéœ€è¦è°ƒè¯•ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤æŸ¥çœ‹æµè§ˆå™¨è¿è¡ŒçŠ¶æ€ï¼š
   ```bash
   docker run -d -p 8000:8000 -p 5900:5900 -e VNC_NO_PASSWORD=1 ghcr.io/your-username/douban-notion:selenium
   ```
   ç„¶åä½¿ç”¨VNCå®¢æˆ·ç«¯è¿æ¥åˆ° `your-server-ip:5900`

## GitHubè‡ªåŠ¨æ„å»º

æœ¬é¡¹ç›®å·²é…ç½®GitHub Actionsè‡ªåŠ¨æ„å»ºæµç¨‹ï¼š

1. æ¨é€ä»£ç åˆ°GitHubä»“åº“çš„mainåˆ†æ”¯
2. GitHub Actionsè‡ªåŠ¨æ„å»ºDockeré•œåƒ
3. é•œåƒå‘å¸ƒåˆ°GitHub Container Registry
4. ç‰ˆæœ¬æ ‡ç­¾ä¼šè‡ªåŠ¨åº”ç”¨ï¼ˆåŸºäºgitæ ‡ç­¾ï¼‰

æ‚¨å¯ä»¥ç›´æ¥é€šè¿‡æ ‡ç­¾å¼•ç”¨æŒ‡å®šç‰ˆæœ¬çš„é•œåƒï¼š
```
ghcr.io/your-username/douban-notion:v1.0.0
``` 